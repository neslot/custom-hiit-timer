<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <base href="/">
    <title>HIIT TIMER</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@500;700;800&family=Sora:wght@500;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="./styles.css">
</head>
<body>
    <div class="ambient ambient-one"></div>
    <div class="ambient ambient-two"></div>
    <div class="ambient ambient-three"></div>

    <div id="intro">
        <header class="intro-topbar">
            <button id="intro-voice-link" class="top-action" onclick="event.stopPropagation(); toggleVoiceMute();">
                <span class="top-label">Voice</span>
                <span id="voice-state-text">On</span>
            </button>
            <div class="top-right-actions">
                <button id="intro-stats-link" class="top-action" onclick="event.stopPropagation(); openStatsPage();">Stats</button>
                <button id="intro-settings-link" class="top-action" onclick="event.stopPropagation(); toggleSettings(true);">Settings</button>
            </div>
        </header>

        <div class="intro-layout">
            <section class="watch-shell" onclick="startWorkout()" role="button" aria-label="Start workout" tabindex="0">
                <div class="watch-crown" aria-hidden="true"></div>
                <div class="watch-face">
                    <div class="watch-brand">HIIT TIMER</div>
                    <div id="watch-time" class="watch-time">15:00</div>
                    <div id="watch-methodology" class="watch-methodology watch-methodology-link" onclick="event.stopPropagation(); toggleSettings(true);" role="button" tabindex="0" aria-label="Open settings">University of Copenhagen</div>
                    <div class="watch-sub">HIIT Program</div>

                    <div class="intro-user" onclick="event.stopPropagation();">
                        <label for="intro-user-select">Select User</label>
                        <select id="intro-user-select" onclick="event.stopPropagation();">
                            <option value="Toby">Toby</option>
                            <option value="Anna">Anna</option>
                        </select>
                    </div>

                    <div class="intro-actions">
                        <button id="intro-start" class="pill-btn primary" onclick="event.stopPropagation(); startWorkout();">Start Session</button>
                    </div>
                </div>
            </section>

            <aside class="home-stats">
                <div class="home-stats-head">
                    <h3>Last Performances</h3>
                    <div class="home-stats-meta">
                        <span id="home-stats-user">Toby</span>
                        <span id="storage-badge" class="storage-badge">Storage: local</span>
                    </div>
                </div>
                <div id="home-range-tabs" class="range-tabs">
                    <button type="button" class="range-tab active" data-range="7">7D</button>
                    <button type="button" class="range-tab" data-range="30">30D</button>
                    <button type="button" class="range-tab" data-range="all">All</button>
                </div>
                <div id="home-stat-kpis" class="home-kpis"></div>
                <ul id="home-performances-list" class="home-list"></ul>
            </aside>
        </div>
    </div>

    <div id="bg-overlay"></div>
    <div id="cooldown-overlay"></div>
    <div id="progress-container"><div id="progress-bar"></div></div>

    <div id="settings-wrap">
        <button id="btn-home" class="top-action hidden" onclick="goHomeFromWorkout()">Home</button>
        <button id="btn-stats" class="top-action" onclick="openStatsPage()">Stats</button>
        <button id="btn-settings" class="top-action" onclick="toggleSettings()">Settings</button>
    </div>

    <label id="voice-toggle-wrap" class="hidden"><input id="voice-toggle" type="checkbox">Mute Voice</label>

    <div id="settings-panel" class="hidden">
        <h3>Workout Settings</h3>
        <p id="methodology-note">Methodology: University of Copenhagen</p>

        <div id="methodology-grid" class="methodology-grid"></div>

        <div class="settings-grid">
            <label>Warm Up (sec)<input id="set-warmup" type="number" min="0" step="5"></label>
            <label>Cool Down (sec)<input id="set-cooldown" type="number" min="0" step="5"></label>
            <label>Block Recovery (sec)<input id="set-block-rest" type="number" min="0" step="5"></label>
            <label>Easy (sec)<input id="set-easy" type="number" min="1" step="1"></label>
            <label>Steady (sec)<input id="set-steady" type="number" min="1" step="1"></label>
            <label>Sprint (sec)<input id="set-sprint" type="number" min="1" step="1"></label>
            <label>Rounds / Block<input id="set-rounds" type="number" min="1" step="1"></label>
            <label>Blocks<input id="set-blocks" type="number" min="1" step="1"></label>
        </div>

        <div class="settings-actions">
            <button class="pill-btn ghost" onclick="toggleSettings(false)">Close</button>
            <button class="pill-btn primary" onclick="applySettings()">Apply</button>
        </div>
    </div>

    <div id="workout-log" class="hidden">
        <div class="card">
            <h3>Log This Session</h3>
            <p id="log-user-context">User: Toby</p>
            <p id="log-protocol-context">Protocol: University of Copenhagen</p>
            <div class="log-grid">
                <label>Equipment
                    <select id="log-instrument">
                        <option value="running">Running</option>
                        <option value="rowing">Rowing</option>
                        <option value="riding">Riding</option>
                        <option value="spin">Spin</option>
                    </select>
                </label>
                <label>Calories
                    <input id="log-calories" type="number" min="0" step="1" placeholder="e.g. 320">
                </label>
                <label>Avg HR
                    <input id="log-avg-hr" type="number" min="0" step="1" placeholder="e.g. 154">
                </label>
            </div>
            <div id="log-metrics" class="log-grid"></div>
            <div class="log-actions">
                <button class="pill-btn ghost" onclick="closeLogModal()">Skip</button>
                <button class="pill-btn primary" onclick="saveWorkoutLog()">Save</button>
            </div>
            <div class="recent-logs">
                <h4>Recent Sessions</h4>
                <ul id="recent-logs-list"></ul>
            </div>
        </div>
    </div>

    <div id="stats-page" class="hidden">
        <div class="stats-page-shell">
            <header class="stats-header">
                <button class="pill-btn ghost" onclick="closeStatsPage()">Back</button>
                <h2>Performance Stats</h2>
            </header>

            <div class="stats-filter-grid">
                <label>User
                    <select id="stats-user-select">
                        <option value="Toby">Toby</option>
                        <option value="Anna">Anna</option>
                    </select>
                </label>
                <label>Metric
                    <select id="stats-metric-select">
                        <option value="calories">Calories</option>
                        <option value="avgHr">Avg HR</option>
                        <option value="durationSec">Duration</option>
                        <option value="distance">Distance</option>
                    </select>
                </label>
                <label>Range
                    <select id="stats-range-select">
                        <option value="7">Last 7 days</option>
                        <option value="30" selected>Last 30 days</option>
                        <option value="90">Last 90 days</option>
                        <option value="all">All time</option>
                    </select>
                </label>
            </div>

            <div class="stats-toggle-group">
                <span>Equipment</span>
                <div id="stats-equipment-toggles" class="chip-row"></div>
            </div>

            <div class="stats-toggle-group">
                <span>Protocol</span>
                <div id="stats-protocol-toggles" class="chip-row"></div>
            </div>

            <div class="stats-cards">
                <section class="stats-card">
                    <h3 id="stats-line-title">Trend</h3>
                    <canvas id="stats-line-canvas" width="900" height="320"></canvas>
                </section>

                <section class="stats-card">
                    <h3>Sessions by Equipment</h3>
                    <canvas id="stats-mix-canvas" width="900" height="280"></canvas>
                </section>

                <section class="stats-card">
                    <h3>Summary</h3>
                    <ul id="stats-summary-list" class="stats-list"></ul>
                </section>

                <section class="stats-card">
                    <h3>Filtered Sessions</h3>
                    <ul id="stats-sessions-list" class="stats-list stats-sessions"></ul>
                </section>
            </div>
        </div>
    </div>

    <div id="phase">Ready</div>
    <div id="timer">15:00</div>
    <div id="instruction">Turn up volume and tap start.</div>

    <div id="controls">
        <button id="btn-start" class="pill-btn primary controls-main" onclick="startWorkout()">Start Session</button>
        <button id="btn-pause" class="pill-btn primary controls-main hidden" onclick="togglePause()">Pause</button>
        <button id="btn-log" class="pill-btn accent hidden" onclick="showLogModal()">Log Session</button>
    </div>

    <div id="toast" class="toast hidden" role="status" aria-live="polite"></div>

    <script src="./app.js"></script>
</body>
</html>
